<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>お気に入り記事一覧 - LiveNote</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; background-color: #f0f2f5; }
        .container { max-width: 800px; margin: auto; padding: 20px; background: #fff; border-radius: 8px; box-sizing: border-box; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 {
            color: #1976d2;
            font-size: 1.6rem;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 18px;
            background: linear-gradient(90deg, #e3f0fc 0%, #f7fafc 100%);
            border-radius: 6px;
            padding: 10px 18px;
            box-shadow: 0 2px 8px rgba(25, 118, 210, 0.07);
            text-align: left;
            display: inline-block;
        }
        ul { list-style-type: none; padding: 0; }
        li { background: #f9f9f9; margin-bottom: 10px; padding: 15px; border-radius: 5px; border: 1px solid #ddd; position: relative; box-sizing: border-box; word-break: break-all; }
        .toggle-favorite-news { width: 50%; min-width: 80px; max-width: 300px; box-sizing: border-box; font-size: 1.05rem; padding: 8px 0; }
        img { max-width: 100%; height: auto; display: block; margin: 8px 0; border-radius: 4px; }
        .back-btn { margin-bottom: 20px; padding:10px 20px; font-size:16px; }
        @media (max-width: 600px) {
            body { margin: 0.5rem; }
            .container { padding: 8px; }
            li { padding: 8px; }
            h1 { font-size: 1.2rem; }
            .back-btn { font-size: 1rem; padding: 8px 12px; }
            .toggle-favorite-news { width: 50%; min-width: 60px; font-size: 0.95rem; padding: 6px 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>お気に入り記事一覧</h1>
        <button class="back-btn" onclick="window.location.href='home.html'" style="background:#1976d2;color:#fff;border:none;border-radius:6px;padding:10px 24px;font-size:1rem;box-shadow:0 2px 6px rgba(0,0,0,0.08);cursor:pointer;transition:background 0.2s;display:block;margin-bottom:20px;margin-left:0;">← ホームに戻る</button>
        <ul id="favorites-list"></ul>
    </div>
    <script>
        const currentUser = localStorage.getItem('currentUser');
        function fetchFavoriteNews() {
            fetch('/api/v1/favorite-news/list?user=' + encodeURIComponent(currentUser))
                .then(res => res.json())
                .then(list => {
                    const ul = document.getElementById('favorites-list');
                    ul.innerHTML = '';
                    if (!list || list.length === 0) {
                        ul.innerHTML = '<li>お気に入り記事はありません</li>';
                        return;
                    }
                    list.forEach(news => {
                        const li = document.createElement('li');
                        let d = new Date(news.date);
                        let jpDate = `${d.getFullYear()}年${d.getMonth()+1}月${d.getDate()}日 ${d.getHours()}時${d.getMinutes()}分`;
                        let imgHtml = '';
                        if (news.artistName && (news.artistName.startsWith('http://') || news.artistName.startsWith('https://'))) {
                            imgHtml = `<img src='${news.artistName}' alt='ニュース画像' style='max-width:300px;display:block;margin:8px 0;'>`;
                        }
                        li.innerHTML = `<strong>タイトル：${news.title}</strong><br>リンク：<a href="${news.url}" target="_blank">${news.url}</a><br>${imgHtml}<span style='color:#888;'>日付：${jpDate}</span><br>`;
                        const btn = document.createElement('button');
                        btn.textContent = '★ お気に入り解除';
                        btn.className = 'toggle-favorite-news';
                        btn.style.background = '#ffe066';
                        btn.style.color = '#d17b00';
                        btn.style.marginTop = '8px';
                        li.appendChild(btn);
                        ul.appendChild(li);
                        btn.onclick = function() {
                            const payload = {
                                user: currentUser,
                                title: news.title,
                                url: news.url,
                                date: news.date,
                                artistName: news.artistName
                            };
                            fetch('/api/v1/favorite-news/toggle', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            })
                            .then(res => res.json())
                            .then(result => {
                                if (result.result === 'removed') {
                                    li.remove();
                                }
                            })
                            .catch(() => {
                                alert('お気に入り解除通信エラー');
                            });
                        };
                    });
                })
                .catch(() => {
                    document.getElementById('favorites-list').innerHTML = '<li>取得エラー</li>';
                });
        }
        fetchFavoriteNews();
    </script>
</body>
</html>
